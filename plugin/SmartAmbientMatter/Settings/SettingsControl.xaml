<UserControl x:Class="SmartAmbientMatter.Settings.SettingsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <UserControl.Resources>
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#FFAAAAAA"/>
            <Setter Property="Margin" Value="0,12,0,6"/>
        </Style>
        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Foreground" Value="#FFCCCCCC"/>
        </Style>
        <Style x:Key="StatusLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FF88BBFF"/>
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="0,2"/>
        </Style>
        <Style x:Key="NarrowTextBox" TargetType="TextBox">
            <Setter Property="Width" Value="180"/>
            <Setter Property="Margin" Value="0,3"/>
        </Style>
        <Style x:Key="SmallButton" TargetType="Button">
            <Setter Property="Margin" Value="0,4,6,0"/>
            <Setter Property="Padding" Value="8,3"/>
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16,8,16,16">
        <StackPanel>

            <!-- ── CONNECTION ────────────────────────────────────────────────── -->
            <TextBlock Text="CONNECTION" Style="{StaticResource SectionHeaderStyle}"/>
            <Border BorderBrush="#FF444444" BorderThickness="0,0,0,1" Margin="0,0,0,8"/>

            <Grid Margin="0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="130"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Text="Bridge Host"
                           Style="{StaticResource LabelStyle}"/>
                <TextBox Grid.Row="0" Grid.Column="1"
                         x:Name="TxtBridgeHost"
                         Style="{StaticResource NarrowTextBox}"
                         ToolTip="IP address of the Python Matter bridge (default: 127.0.0.1)"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Bridge Port"
                           Style="{StaticResource LabelStyle}" Margin="0,8,8,0"/>
                <TextBox Grid.Row="1" Grid.Column="1"
                         x:Name="TxtBridgePort"
                         Style="{StaticResource NarrowTextBox}"
                         Margin="0,8,0,0"
                         ToolTip="UDP port the Python bridge listens on (default: 10001)"/>
            </Grid>

            <!-- ── SCREEN CAPTURE ─────────────────────────────────────────────── -->
            <TextBlock Text="SCREEN CAPTURE" Style="{StaticResource SectionHeaderStyle}" Margin="0,20,0,6"/>
            <Border BorderBrush="#FF444444" BorderThickness="0,0,0,1" Margin="0,0,0,8"/>

            <TextBlock Text="Captures the game screen and derives Kelvin + Brightness from average pixel color. Weather, tunnels, and time-of-day are all handled automatically."
                       Foreground="#FF888888" FontSize="11" TextWrapping="Wrap" Margin="0,0,0,8"/>

            <Grid Margin="0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="160"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="60"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Monitor Index -->
                <TextBlock Grid.Row="0" Grid.Column="0" Text="Monitor Index (0=primary)"
                           Style="{StaticResource LabelStyle}" Margin="0,8,8,0"/>
                <TextBox Grid.Row="0" Grid.Column="1"
                         x:Name="TxtMonitorIndex"
                         Width="50" HorizontalAlignment="Left"
                         Margin="0,8,0,0"
                         ToolTip="0 = primary monitor, 1 = second monitor, etc."/>

                <!-- Capture Region -->
                <TextBlock Grid.Row="1" Grid.Column="0" Text="Capture Region"
                           Style="{StaticResource LabelStyle}" Margin="0,12,8,0"/>
                <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2"
                            Orientation="Horizontal" Margin="0,12,0,0">
                    <TextBlock Text="X:" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="TxtCapX" Width="55" Margin="0,0,8,0"
                             ToolTip="Horizontal offset within monitor (pixels)"/>
                    <TextBlock Text="Y:" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="TxtCapY" Width="55" Margin="0,0,8,0"
                             ToolTip="Vertical offset within monitor (pixels)"/>
                    <TextBlock Text="W:" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="TxtCapW" Width="55" Margin="0,0,8,0"
                             ToolTip="Width of capture region (0 = full monitor width)"/>
                    <TextBlock Text="H:" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="TxtCapH" Width="55" Margin="0,0,8,0"
                             ToolTip="Height of capture region (0 = full monitor height)"/>
                    <TextBlock Text="(0,0,0,0 = full monitor)"
                               Foreground="#FF888888" FontSize="10" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Sample Step -->
                <TextBlock Grid.Row="2" Grid.Column="0" Text="Sample Step"
                           Style="{StaticResource LabelStyle}" Margin="0,12,8,0"
                           ToolTip="Sample every Nth pixel. Higher = faster but less accurate."/>
                <Slider Grid.Row="2" Grid.Column="1"
                        x:Name="SliderSampleStep"
                        Minimum="5" Maximum="50" SmallChange="5"
                        TickFrequency="5" IsSnapToTickEnabled="True"
                        ValueChanged="SliderSampleStep_ValueChanged" Margin="0,14,8,0"/>
                <TextBlock Grid.Row="2" Grid.Column="2"
                           x:Name="LblSampleStep" VerticalAlignment="Center"
                           Style="{StaticResource LabelStyle}" Margin="0,12,0,0"/>

                <!-- Capture Interval -->
                <TextBlock Grid.Row="3" Grid.Column="0" Text="Capture Interval (ms)"
                           Style="{StaticResource LabelStyle}" Margin="0,12,8,0"
                           ToolTip="How often to grab the screen. 100ms = 10 Hz."/>
                <Slider Grid.Row="3" Grid.Column="1"
                        x:Name="SliderCaptureMs"
                        Minimum="50" Maximum="500" SmallChange="50"
                        TickFrequency="50" IsSnapToTickEnabled="True"
                        ValueChanged="SliderCaptureMs_ValueChanged" Margin="0,14,8,0"/>
                <TextBlock Grid.Row="3" Grid.Column="2"
                           x:Name="LblCaptureMs" VerticalAlignment="Center"
                           Style="{StaticResource LabelStyle}" Margin="0,12,0,0"/>

                <!-- Brightness Floor -->
                <TextBlock Grid.Row="4" Grid.Column="0" Text="Brightness Floor"
                           Style="{StaticResource LabelStyle}" Margin="0,12,8,0"
                           ToolTip="Minimum bulb brightness. Prevents total darkness when screen is black."/>
                <Slider Grid.Row="4" Grid.Column="1"
                        x:Name="SliderBrightMin"
                        Minimum="0" Maximum="50" SmallChange="1"
                        ValueChanged="SliderBrightMin_ValueChanged" Margin="0,14,8,0"/>
                <TextBlock Grid.Row="4" Grid.Column="2"
                           x:Name="LblBrightMin" VerticalAlignment="Center"
                           Style="{StaticResource LabelStyle}" Margin="0,12,0,0"/>

                <!-- Brightness Ceiling -->
                <TextBlock Grid.Row="5" Grid.Column="0" Text="Brightness Ceiling"
                           Style="{StaticResource LabelStyle}" Margin="0,12,8,0"
                           ToolTip="Maximum bulb brightness for full-white screens."/>
                <Slider Grid.Row="5" Grid.Column="1"
                        x:Name="SliderBrightMax"
                        Minimum="100" Maximum="254" SmallChange="1"
                        ValueChanged="SliderBrightMax_ValueChanged" Margin="0,14,8,0"/>
                <TextBlock Grid.Row="5" Grid.Column="2"
                           x:Name="LblBrightMax" VerticalAlignment="Center"
                           Style="{StaticResource LabelStyle}" Margin="0,12,0,0"/>
            </Grid>

            <!-- ── ZONES ─────────────────────────────────────────────────────── -->
            <TextBlock Text="ZONES" Style="{StaticResource SectionHeaderStyle}" Margin="0,20,0,6"/>
            <Border BorderBrush="#FF444444" BorderThickness="0,0,0,1" Margin="0,0,0,8"/>

            <TextBlock Text="Each zone is a named group of Matter bulbs that receives identical lighting commands."
                       Foreground="#FF888888" FontSize="11" TextWrapping="Wrap" Margin="0,0,0,8"/>

            <ListBox x:Name="ZoneListBox"
                     SelectionMode="Single"
                     MaxHeight="260"
                     Background="#FF2A2A2A"
                     BorderBrush="#FF555555"
                     Margin="0,0,0,6">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="6,5" BorderBrush="#FF3A3A3A" BorderThickness="0,0,0,1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="90"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="100"/>
                                </Grid.ColumnDefinitions>

                                <!-- Zone Name -->
                                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                    <TextBlock Text="Name" Foreground="#FF888888" FontSize="10"/>
                                    <TextBox x:Name="TxtZoneName"
                                             Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                             Width="80" Margin="0,2,4,0" FontSize="11"/>
                                </StackPanel>

                                <!-- Node IDs -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="4,0">
                                    <TextBlock Text="Node IDs (comma-separated)" Foreground="#FF888888" FontSize="10"/>
                                    <TextBox x:Name="TxtNodeIds"
                                             Tag="{Binding}"
                                             Width="140" Margin="0,2,4,0" FontSize="11"
                                             ToolTip="Matter node IDs, e.g. 1,2,3"
                                             LostFocus="TxtNodeIds_LostFocus"/>
                                </StackPanel>

                                <!-- Brightness Multiplier -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="4,0">
                                    <TextBlock Text="Brightness" Foreground="#FF888888" FontSize="10"/>
                                    <TextBlock Text="Multiplier" Foreground="#FF888888" FontSize="10"/>
                                    <TextBox x:Name="TxtBrightMult"
                                             Text="{Binding BrightnessMultiplier, UpdateSourceTrigger=PropertyChanged, StringFormat=F2}"
                                             Width="56" Margin="0,2,4,0" FontSize="11"
                                             ToolTip="1.0 = 100%, 0.6 = 60% brightness"/>
                                </StackPanel>

                                <!-- Per-row status -->
                                <StackPanel Grid.Column="3" VerticalAlignment="Center" Margin="4,0">
                                    <TextBlock x:Name="TxtZoneStatus"
                                               Foreground="#FF88BBFF" FontFamily="Consolas" FontSize="10"
                                               Tag="{Binding Name}"
                                               Text="—"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                <Button Content="Add Zone" Style="{StaticResource SmallButton}"
                        Click="BtnAddZone_Click"
                        ToolTip="Add a new zone with default settings"/>
                <Button Content="Remove Selected" Style="{StaticResource SmallButton}"
                        Click="BtnRemoveZone_Click"
                        ToolTip="Remove the selected zone"/>
            </StackPanel>

            <!-- ── TUNING ─────────────────────────────────────────────────────── -->
            <TextBlock Text="TUNING" Style="{StaticResource SectionHeaderStyle}" Margin="0,20,0,6"/>
            <Border BorderBrush="#FF444444" BorderThickness="0,0,0,1" Margin="0,0,0,8"/>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="50"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Intensity Threshold -->
                <TextBlock Grid.Row="0" Grid.Column="0" Text="Intensity Threshold"
                           Style="{StaticResource LabelStyle}" Margin="0,8,8,0"
                           ToolTip="Min change (0-1) to trigger a send. Higher = fewer updates."/>
                <Slider Grid.Row="0" Grid.Column="1"
                        x:Name="SliderIntensity"
                        Minimum="0.005" Maximum="0.10" SmallChange="0.005"
                        TickFrequency="0.005" IsSnapToTickEnabled="True"
                        ValueChanged="SliderIntensity_ValueChanged" Margin="0,10,8,0"/>
                <TextBlock Grid.Row="0" Grid.Column="2"
                           x:Name="LblIntensityVal" VerticalAlignment="Center"
                           Style="{StaticResource LabelStyle}" Margin="0,8,0,0"/>

                <!-- Min Sleep Ms -->
                <TextBlock Grid.Row="1" Grid.Column="0" Text="Min Sleep (ms)"
                           Style="{StaticResource LabelStyle}" Margin="0,12,8,0"
                           ToolTip="Hard cooldown between updates per zone. Increase if bulbs disconnect."/>
                <Slider Grid.Row="1" Grid.Column="1"
                        x:Name="SliderSleep"
                        Minimum="1000" Maximum="3000" SmallChange="100"
                        TickFrequency="100" IsSnapToTickEnabled="True"
                        ValueChanged="SliderSleep_ValueChanged" Margin="0,14,8,0"/>
                <TextBlock Grid.Row="1" Grid.Column="2"
                           x:Name="LblSleepVal" VerticalAlignment="Center"
                           Style="{StaticResource LabelStyle}" Margin="0,12,0,0"/>

                <!-- Tunnel Bright Drop -->
                <TextBlock Grid.Row="2" Grid.Column="0" Text="Tunnel Brightness Drop"
                           Style="{StaticResource LabelStyle}" Margin="0,12,8,0"
                           ToolTip="Screen brightness drop (per capture) that triggers Guillotine. Lower = more sensitive to sudden darkness."/>
                <Slider Grid.Row="2" Grid.Column="1"
                        x:Name="SliderTunnelDrop"
                        Minimum="10" Maximum="100" SmallChange="5"
                        TickFrequency="5" IsSnapToTickEnabled="True"
                        ValueChanged="SliderTunnelDrop_ValueChanged" Margin="0,14,8,0"/>
                <TextBlock Grid.Row="2" Grid.Column="2"
                           x:Name="LblTunnelDropVal" VerticalAlignment="Center"
                           Style="{StaticResource LabelStyle}" Margin="0,12,0,0"/>

                <!-- Tunnel Bright Floor -->
                <TextBlock Grid.Row="3" Grid.Column="0" Text="Tunnel Brightness Floor"
                           Style="{StaticResource LabelStyle}" Margin="0,12,8,0"
                           ToolTip="Max brightness considered 'in tunnel'. Lower = stricter."/>
                <Slider Grid.Row="3" Grid.Column="1"
                        x:Name="SliderTunnelFloor"
                        Minimum="10" Maximum="100" SmallChange="5"
                        TickFrequency="5" IsSnapToTickEnabled="True"
                        ValueChanged="SliderTunnelFloor_ValueChanged" Margin="0,14,8,0"/>
                <TextBlock Grid.Row="3" Grid.Column="2"
                           x:Name="LblTunnelFloorVal" VerticalAlignment="Center"
                           Style="{StaticResource LabelStyle}" Margin="0,12,0,0"/>
            </Grid>

            <!-- ── LIVE STATUS ─────────────────────────────────────────────────── -->
            <TextBlock Text="LIVE STATUS" Style="{StaticResource SectionHeaderStyle}" Margin="0,20,0,6"/>
            <Border BorderBrush="#FF444444" BorderThickness="0,0,0,1" Margin="0,0,0,8"/>

            <StackPanel Background="#FF232323" Margin="0,4,0,0">
                <TextBlock x:Name="LblGameRunning" Style="{StaticResource StatusLabelStyle}"
                           Margin="6,6,6,2"/>
                <TextBlock x:Name="LblCurrentKelvin" Style="{StaticResource StatusLabelStyle}"
                           Margin="6,2"/>
                <TextBlock x:Name="LblCurrentBrightness" Style="{StaticResource StatusLabelStyle}"
                           Margin="6,2"/>
                <TextBlock x:Name="LblAvgRgb" Style="{StaticResource StatusLabelStyle}"
                           Margin="6,2"/>
                <TextBlock x:Name="LblZoneStatus" Style="{StaticResource StatusLabelStyle}"
                           Margin="6,2,6,6" TextWrapping="Wrap"/>
            </StackPanel>

            <!-- ── SAVE BUTTON ────────────────────────────────────────────────── -->
            <Button Content="Save Settings"
                    x:Name="BtnSave"
                    Click="BtnSave_Click"
                    Margin="0,16,0,4"
                    Padding="14,5"
                    HorizontalAlignment="Left"
                    FontWeight="SemiBold"
                    ToolTip="Save all settings and reload zone manager"/>

        </StackPanel>
    </ScrollViewer>
</UserControl>
